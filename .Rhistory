source('~/Dropbox/Grattan Dropbox/Budget Repair Report/Data and analysis/Superannuation/R modelling/Super contributions - cameos.R')
getwd()
setwd("C:/Users/Hugh/Documents/")
library(readxl)
read_excel("Forecasts.xlsx")
read_excel("Forecasts.xlsx") %>% tidyr::gather(Year, value, `2003`:Actual)
library(magrittr)
read_excel("Forecasts.xlsx") %>% tidyr::gather(Year, value, `2003`:Actual)
read_excel("Forecasts.xlsx") %>% tidyr::gather(Year, value, `2003`:Actual) %>% ggplot(aes(x = Year, y= value, colour = `Year of forecast)) + geom_line()
read_excel("Forecasts.xlsx") %>% tidyr::gather(Year, value, `2003`:Actual) %>% ggplot(aes(x = Year, y= value, colour = `Year of forecast`)) + geom_line()
library(ggplot2)
read_excel("Forecasts.xlsx") %>% tidyr::gather(Year, value, `2003`:Actual) %>% ggplot(aes(x = Year, y= value, colour = `Year of forecast`)) + geom_line()
read_excel("Forecasts.xlsx") %>% tidyr::gather(Year, value, `2003`:Actual) %>% mutate(`Year of forecast` = factor(`Year of forecast`)) %>% ggplot(aes(x = Year, y= value, colour = `Year of forecast`, group = `Year of forecast`)) + geom_line()
library(dplyr)
read_excel("Forecasts.xlsx") %>% tidyr::gather(Year, value, `2003`:Actual) %>% mutate(`Year of forecast` = factor(`Year of forecast`)) %>% ggplot(aes(x = Year, y= value, colour = `Year of forecast`, group = `Year of forecast`)) + geom_line()
read_excel("Forecasts.xlsx") %>% tidyr::gather(Year, value, `2003`:Actual) %>% mutate(`Year of forecast` = factor(`Year of forecast`)) %>% ggplot(aes(x = Year, y= value, colour = `Year of forecast`, group = `Year of forecast`)) + geom_line() -> p
install.packages("directlabels")
library("directlabels")
direct.label(p)
read_excel("Forecasts.xlsx") %>% tidyr::gather(Year, value, `2003`:Actual) %>% mutate(Forecast_year = factor(`Year of forecast`)) %>% ggplot(aes(x = Year, y= value, colour = Forecast_year, group = Forecast_year)) + geom_line() -> p
direct.label(p)
p
library("grattan")
p + scale_color_manual(values = rep(gpal(6)))
p + scale_color_manual(values = rep(gpal(6), 3))
p + scale_color_manual(values = rep(gpal(6), 3)) + theme_hugh()
direct.label(p, method = "first.points")
direct.label(p, method = "last.points")
direct.label(p, method = "first.qp")
?direct.label
?apply.method
p + scale_color_manual(values = rep(gpal(6), 3)) + theme_hugh()
p + scale_color_manual(values = rep(gpal(6), 3)) + theme_hugh() + scale_y_continuous(limits = c(-5, 2.5))
p + scale_color_manual(values = rep(gpal(6), 3)) + theme_hugh() + scale_y_continuous(limits = c(-5, 2.5), expand = c(0,0))
p + scale_color_manual(values = rep(gpal(6), 3)) + theme_hugh() + scale_y_continuous(limits = c(-5, 2.5), expand = c(0,0)) -> p
direct.labels(p)
direct.label(p)
direct.label(p, "first.points")
direct.label(p, "last.points")
direct.label(p, "top.points")
direct.label(p, dl.combine(list("top.points", "dl.jitter"))
)
direct.label(p, "last.qp")
direct.label(p, "lines2")
direct.label(p, "lines")
direct.label(p, "bottom.pieces")
direct.label(p, "lasso.labels")
direct.label(p, "first.polygons")
direct.label(p, "angled.boxes")
direct.label(p, "last.bumpup")
read_excel("Forecasts.xlsx") %>% tidyr::gather(Year, value, `2003`:`2015 MYEFO`) %>% mutate(Forecast_year = factor(`Year of forecast`)) %>% ggplot(aes(x = Year, y= value, colour = Forecast_year, group = Forecast_year)) + geom_line() -> p
p
direct.label(p, "last.bumpup")
p + scale_color_manual(values = rep(gpal(6), 3)) + theme_hugh() + scale_y_continuous(limits = c(-5, 2.5), expand = c(0,0)) -> p
direct.label(p, "last.bumpup")
read_excel("Forecasts.xlsx") %>% tidyr::gather(Forecast_Year, value, `2003`:`2015 MYEFO`) %>% mutate(Year = factor(`Year of forecast`)) %>% ggplot(aes(x = Year, y= value, colour = Forecast_year, group = Forecast_year)) + geom_line() -> p
read_excel("Forecasts.xlsx") %>% tidyr::gather(Forecast_Year, value, `2003`:`2015 MYEFO`) %>% mutate(Year = factor(`Year of forecast`)) %>% ggplot(aes(x = Forecast_Year, y= value, colour = Year, group = Year)) + geom_line() -> p
direct.label(p, "last.bumpup")
read_excel("Forecasts.xlsx") %>% tidyr::gather(Forecast_Year, value, `2003`:`2015 MYEFO`) %>% mutate(Year = factor(`Year of forecast`)) %>% ggplot(aes(x = Year, y= value, colour = Forecast_year, group = Forecast_year)) + geom_line() -> p
direct.label(p, "last.bumpup")
search()
devtools::install_github("HughParsonage/github")
devtools::install_github("HughParsonage/grattan")
library(help = "grattan")
library(grattan)
?grattan
remove.packages("grattan")
devtools::install_github("HughParsonage/grattan")
library(help = "grattan")
?grattan_waterfall
remove.packages("grattan")
devtools::install_github("HughParsonage/grattan")
library(grattan)
?grattan_waterfal
?grattan_waterfall
remove.packages("grattan")
detach(package:grattan, unload=TRUE)
remove.packages("grattan")
library(devtools)
library(grattan)
library(devtools)
install_github("HughParsonage/grattan")
library(grattan)
library(help = "grattan")
?"grattan_waterfall"
grattan_waterfall
grattan_waterfall(values = rnorm(5), labels = letters[1:%])
grattan_waterfall(values = rnorm(5), labels = letters[1:5])
library(ggplot2)
grattan_waterfall(values = rnorm(5), labels = letters[1:5])
grattan_waterfall(values = rnorm(5), labels = letters[1:5], calc_total = T)
search()
library(grattan)
library(ggplot2)
?scale_color_brewer
ggplot(diamonds) + geom_point(aes(x = cut, y = price))
ggplot(diamonds) + geom_point(aes(x = carat, y = price))
ggplot(diamonds) + geom_point(aes(x = carat, y = price, colour = cut))
ggplot(diamonds) + geom_point(aes(x = carat, y = price, colour = cut)) + scale_color_brewer(palette = gpal(6))
?palette
palette(gpal(6))
palette()
ggplot(diamonds) + geom_point(aes(x = carat, y = price, colour = cut))
gpal(6)
ggplot(diamonds) + geom_point(aes(x = carat, y = price, colour = cut)) + scale_color_brewer(palette = palette(gpal(6)))
rainbow(6)
ggplot(diamonds) + geom_point(aes(x = carat, y = price, colour = cut)) + scale_color_brewer(palette = palette())
?colorRampPalette()
ggplot(diamonds) + geom_point(aes(x = carat, y = price, colour = cut)) + scale_color_brewer(palette = colorRampPalette(color = gpal(6)))
ggplot(diamonds) + geom_point(aes(x = carat, y = price, colour = cut)) + scale_color_brewer(palette = colorRamp(color = gpal(6)))
?set_default_scale
?scales::brewer_pal
show_col(brewer_pal(gpal(6)))
scales::show_col(brewer_pal(gpal(6)))
gradient_n_pal
library(scales)
gradient_n_pal
gradient_n_pal(gpal(6))
gradient_n_pal(gpal(6))()
gradient_n_pal(gpal(6))(0,1)
scale_color_discrete
?discrete_scale
scale_color_Grattan <- function(...) discrete_scale("colour", "hue", function(n) gpal(n))
ggplot(diamonds) + geom_point(aes(x = carat, y = price, colour = cut)) + scale_color_Grattan()
ggplot(diamonds) + geom_point(aes(x = carat, y = price, colour = cut)) + scale_color_Grattan()
library(ggplot2)
ggplot(diamonds) + geom_point(aes(x = carat, y = price, colour = cut)) + scale_color_Grattan()
scale_color_Grattan <- function(...) discrete_scale("colour", "hue", function(n) gpal(n))
ggplot(diamonds) + geom_point(aes(x = carat, y = price, colour = cut)) + scale_color_Grattan()
library(grattan)
ggplot(diamonds) + geom_point(aes(x = carat, y = price, colour = cut)) + scale_color_Grattan()
?ggplot2::theme
library(wealthofgenerations)
library(help = "wealthofgenerations)
library(help = "wealthofgenerations")
expand.MEANS
expand.SINGLE
library(help = "arm")
?gam
??Gam
library(help = "mgcv")
source('~/Health_spending_alternate_chart.R', echo=TRUE)
readr::read_csv("C:/Users/Hugh/Documents/Health_spending.csv") %>%
mutate(Age = factor(Age)) %>%
group_by(Age) %>%
mutate(age_rel_div = Amount/first(Amount),
age_rel_dif = Amount - first(Amount)) %>%
ggplot(aes(x = Year, y = age_rel_dif, colour = Age, group = interaction(Age))) +
stat_smooth(size=1.45)
theme_hugh() +
scale_colour_manual(values = rev(gpalx(9))) +
scale_y_continuous(label=dollar) +
ggtitle("Health spending increased for all ages, but mostly for the older cohorts\nReal spending by age minus spending in 1989, smoothed by loess") ->
p
direct.label(p, list("last.qp", fontface = "bold", x = x + 0.1, cex = 1.2))
readr::read_csv("C:/Users/Hugh/Documents/Health_spending.csv") %>%
mutate(Age = factor(Age)) %>%
group_by(Age) %>%
mutate(age_rel_div = Amount/first(Amount),
age_rel_dif = Amount - first(Amount)) %>%
ggplot(aes(x = Year, y = age_rel_dif, colour = Age, group = interaction(Age))) +
stat_smooth(size=1.45) +
theme_hugh() +
scale_colour_manual(values = rev(gpalx(9))) +
scale_y_continuous(label=dollar) +
ggtitle("Health spending increased for all ages, but mostly for the older cohorts\nReal spending by age minus spending in 1989, smoothed by loess") ->
p
direct.label(p, list("last.qp", fontface = "bold", x = x + 0.1, cex = 1.2))
readr::read_csv("C:/Users/Hugh/Documents/Health_spending.csv") %>%
mutate(Age = factor(Age)) %>%
group_by(Age) %>%
mutate(age_rel_div = Amount/first(Amount),
age_rel_dif = Amount - first(Amount)) %>%
ggplot(aes(x = Year, y = age_rel_dif, colour = Age, group = interaction(Age))) +
stat_smooth(size=1.45) +
theme_hugh() +
scale_colour_manual(values = rev(gpalx(9))) +
scale_y_continuous(label=dollar) +
ggtitle("Health spending increased for all ages, but mostly for the older cohorts\nReal spending by age minus spending in 1989, smoothed by loess") ->
p
direct.label(p, list("last.qp", fontface = "bold", dl.trans(x = x + 0.1, cex = 1.2)))
readr::read_csv("C:/Users/Hugh/Documents/Health_spending.csv") %>%
mutate(Age = factor(Age)) %>%
group_by(Age) %>%
mutate(age_rel_div = Amount/first(Amount),
age_rel_dif = Amount - first(Amount)) %>%
ggplot(aes(x = Year, y = age_rel_dif, colour = Age, group = interaction(Age))) +
stat_smooth(size=1.45) +
theme_hugh() +
scale_colour_manual(values = rev(gpalx(9))) +
scale_y_continuous(label=dollar) +
ggtitle("Health spending increased for all ages, but mostly for the older cohorts\nReal spending by age minus spending in 1989, smoothed by loess") ->
p
direct.label(p, list(fontface = "bold", dl.trans(x = x + 0.1, cex = 1.2), "last.qp"))
readr::read_csv("C:/Users/Hugh/Documents/Health_spending.csv") %>%
mutate(Age = factor(Age)) %>%
group_by(Age) %>%
mutate(age_rel_div = Amount/first(Amount),
age_rel_dif = Amount - first(Amount)) %>%
filter(Age == 80)
readr::read_csv("C:/Users/Hugh/Documents/Health_spending.csv") %>%
mutate(Age = factor(Age)) %>%
group_by(Age) %>%
mutate(age_rel_div = Amount/first(Amount),
age_rel_dif = Amount - first(Amount)) %>%
ggplot(aes(x = Year, y = age_rel_dif, colour = Age, group = interaction(Age))) +
stat_smooth(size=1.45) +
theme_hugh() +
scale_colour_manual(values = rev(gpalx(9))) +
scale_y_continuous(label=dollar, limits = c(-1000, 10000)) +
ggtitle("Health spending increased for all ages, but mostly for the older cohorts\nReal spending by age minus spending in 1989, smoothed by loess") ->
p
direct.label(p, list(fontface = "bold", dl.trans(x = x + 0.1, cex = 1.2), "last.qp"))
readr::read_csv("C:/Users/Hugh/Documents/Health_spending.csv") %>%
mutate(Age = factor(Age)) %>%
group_by(Age) %>%
mutate(age_rel_div = Amount/first(Amount),
age_rel_dif = Amount - first(Amount)) %>%
ggplot(aes(x = Year, y = age_rel_dif, colour = Age, group = interaction(Age))) +
stat_smooth(size=1.45) +
theme_hugh() +
scale_colour_manual(values = rev(gpalx(9))) +
scale_y_continuous(label=dollar, limits = c(-0500, 10000)) +
ggtitle("Health spending increased for all ages, but mostly for the older cohorts\nReal spending by age minus spending in 1989, smoothed by loess") ->
p
direct.label(p, list(fontface = "bold", dl.trans(x = x + 0.1, cex = 1.2), "last.qp"))
?expression
?italic
readr::read_csv("C:/Users/Hugh/Documents/Health_spending.csv") %>%
mutate(Age = factor(Age)) %>%
group_by(Age) %>%
mutate(age_rel_div = Amount/first(Amount),
age_rel_dif = Amount - first(Amount)) %>%
ggplot(aes(x = Year, y = age_rel_dif, colour = Age, group = interaction(Age))) +
stat_smooth(size=1.45) +
theme_hugh() +
scale_colour_manual(values = rev(gpalx(9))) +
scale_y_continuous(label=dollar, limits = c(-0500, 10000)) +
ggtitle(expression(atop("Health spending increased for all ages, but mostly for the older cohorts",
atop("Real spending by age minus spending in 1989, smoothed by loess")))) ->
p
direct.label(p, list(fontface = "bold", dl.trans(x = x + 0.1, cex = 1.2), "last.qp"))
readr::read_csv("C:/Users/Hugh/Documents/Health_spending.csv") %>%
mutate(Age = factor(Age)) %>%
group_by(Age) %>%
mutate(age_rel_div = Amount/first(Amount),
age_rel_dif = Amount - first(Amount)) %>%
ggplot(aes(x = Year, y = age_rel_dif, colour = Age, group = interaction(Age))) +
stat_smooth(size=1.45) +
theme_hugh() +
scale_colour_manual(values = rev(gpalx(9))) +
scale_y_continuous(label=dollar, limits = c(-0500, 10000)) +
ggtitle(expression(atop("Health spending increased for all ages, but mostly for the older cohorts",
atop("Real spending by age minus spending in 1989, smoothed by loess")))) +
theme(plot.title = element_text(hjust = 0)) ->
p
direct.label(p, list(fontface = "bold", dl.trans(x = x + 0.1, cex = 1.2), "last.qp"))
?theme
readr::read_csv("C:/Users/Hugh/Documents/Health_spending.csv") %>%
mutate(Age = factor(Age)) %>%
group_by(Age) %>%
mutate(age_rel_div = Amount/first(Amount),
age_rel_dif = Amount - first(Amount)) %>%
ggplot(aes(x = Year, y = age_rel_dif, colour = Age, group = interaction(Age))) +
stat_smooth(size=1.45) +
theme_hugh() +
scale_colour_manual(values = rev(gpalx(9))) +
scale_y_continuous(label=dollar, limits = c(-0500, 10000)) +
ggtitle(expression(atop("Health spending increased for all ages, but mostly for the older cohorts",
atop("Real spending by age minus spending in 1989, smoothed by loess")))) +
theme(title = element_text(hjust = 0), plot.title = element_text(hjust = 0)) ->
p
direct.label(p, list(fontface = "bold", dl.trans(x = x + 0.1, cex = 1.2), "last.qp"))
?atop
source('C:/Users/Hugh/Dropbox (Grattan Institute)/Health_spending_alternate_chart.R', echo=TRUE)
source('C:/Users/Hugh/Dropbox (Grattan Institute)/Health_spending_alternate_chart.R', echo=TRUE)
source('C:/Users/Hugh/Dropbox (Grattan Institute)/Health_spending_alternate_chart.R', echo=TRUE)
source('C:/Users/Hugh/Dropbox (Grattan Institute)/Health_spending_alternate_chart.R', echo=TRUE)
readr::read_csv("C:/Users/Hugh/Documents/Health_spending.csv") %>%
mutate(Age = factor(Age)) %>%
group_by(Age) %>%
mutate(age_rel_div = Amount/first(Amount),
age_rel_dif = Amount - first(Amount)) %>%
ggplot(aes(x = Year, y = age_rel_dif, colour = Age, group = interaction(Age))) +
stat_smooth(size=1.45) +
theme_hugh() +
scale_colour_manual(values = rev(gpalx(9))) +
scale_y_continuous(label=dollar, limits = c(-0500, 10000)) +
ggtitle(expression(atop(bold("Health spending increased for all ages, but mostly for the older cohorts"),
atop("Real spending by age minus spending in 1989, smoothed by loess                                                  ")))) +
theme(title = element_text(color = theGrey, hjust = 0)) ->
p
direct.label(p, list(fontface = "bold", dl.trans(x = x + 0.1, cex = 1.2), "last.qp"))
source('C:/Users/Hugh/Dropbox (Grattan Institute)/Health_spending_alternate_chart.R', echo=TRUE)
remove.packages("grattan")
devtools::install_github("HughParsonage/grattan")
library(grattan)
?chart_data
chart_data
henry_taxstats %>%
group_by(taxable_income_decile = ntile(Taxable_Income, 10)) %>%
summarise(mean_current_tax = mean(current_tax),
mean_new_tax = mean(new_tax)) %>%
gather(new_vs_current, tax, mean_current_tax:mean_new_tax) %T>%
chart_data %>%
grplot(aes(x = taxable_income_decile, y = tax, fill = new_vs_current)) +
geom_bar(stat = "identity",
position = "dodge") +
theme(legend.position = c(0.1,0.8)) +
scale_y_continuous(expand = c(0,0), label=grattan_dollar) +
xlab("Taxable Income decile")
source('~/.active-rstudio-document', echo=TRUE)
setwd("~/GitHub/CGT_NG_Costings/Costings/Negative_gearing")
source('~/.active-rstudio-document', echo=TRUE)
source('~/.active-rstudio-document', echo=TRUE)
source('~/.active-rstudio-document', echo=TRUE)
source('~/.active-rstudio-document', echo=TRUE)
fread(sample_file_of(2013)) -> tax2013
tax2013 %>% group_by(TaxBrackets = cut(Taxable_Income, breaks = c(-Inf, 0, 20e3, 50e3, 100e3, Inf))) %>% tally
tax2013 %>% group_by(TaxBrackets = cut(Taxable_Income, breaks = c(-Inf, 0, 20e3, 50e3, 100e3, Inf))) %>% tally %>% arrange(TaxBrackets)
tax2013 %>% group_by(TaxBrackets = cut(Taxable_Income, breaks = c(-Inf, 0, 20e3, 50e3, 100e3, Inf))) %>% summarise(marginal.tax = mean(income_tax(Taxable_Income) - income_tax(Taxable_Income + 1)))
tax2013 %>% group_by(TaxBrackets = cut(Taxable_Income, breaks = c(-Inf, 0, 20e3, 50e3, 100e3, Inf))) %>% summarise(marginal.tax = mean(income_tax(Taxable_Income) + income_tax(Taxable_Income + 1)))
tax2013 %>% group_by(TaxBrackets = cut(Taxable_Income, breaks = c(-Inf, 0, 20e3, 50e3, 100e3, Inf))) %>% summarise(marginal.tax = mean(income_tax(Taxable_Income + 1) - income_tax(Taxable_Income)))
tax2013 %>% group_by(TaxBrackets = cut(Taxable_Income, breaks = c(-Inf, 0, 20e3, 50e3, 100e3, Inf))) %>% summarise(marginal.tax = mean(income_tax(Taxable_Income + 1) - income_tax(Taxable_Income))) %>% arrange(TaxBrackets)
income_tax(2005)
income_tax(20005)
which(income_tax(1:30e3) > 0)
which.min(income_tax(1:30e3) > 0)
min(which(income_tax(1:30e3) > 0))
income_tax(20543)
remove.packages("grattan")
devtools::install_github("HughParsonage/grattan")
income_tax(20543)
income_tax
tax2013
tax2013 %>%
mutate(benefit_due_NG = income_tax(Taxable_Income - pmin(0, Net_rent_amt)) - income_tax(Taxable_Income))
tax2013 %>%
mutate(benefit_due_NG = income_tax(Taxable_Income - pmin(0, Net_rent_amt)) - income_tax(Taxable_Income)) %>%
group_by(Above80 = Taxable_Income > 80e3) %>%
summarise(tot.Benefit = sum(benefit_due_NG))
tax2013 %>%
mutate(benefit_due_NG = income_tax(Taxable_Income - pmin(0, Net_rent_amt)) - income_tax(Taxable_Income)) %>%
group_by(Above80 = Taxable_Income > 80e3) %>%
summarise(tot.Benefit = sum(benefit_due_NG)) %>%
ungroup %>%
mutate(prop = tot.Benefit/sum(tot.Benefit))
tax2013 %>%
mutate(benefit_due_NG = income_tax(Taxable_Income - pmin(0, Net_rent_amt)) - income_tax(Taxable_Income)) %>%
group_by(Above80 = Taxable_Income - pmin(0, Net_rent_amt) > 80e3) %>%
summarise(tot.Benefit = sum(benefit_due_NG)) %>%
ungroup %>%
mutate(prop = tot.Benefit/sum(tot.Benefit))
tax2013 %$%
mean(Taxable_Income > 80e3)
